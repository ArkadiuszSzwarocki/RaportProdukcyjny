{% extends 'layout.html' %}
{% block content %}
<div class="section-box p-20">
    <h2>{{ _('test_okien') }}</h2>
    <p>{{ _('uzytkownik_instrukcja') }}</p>

    <div class="gap-10" style="display:flex;flex-wrap:wrap;">
        <a href="/_test/slide/form" data-slide class="btn">Slide: Formularz</a>
        <a href="/_test/slide/confirm" data-slide class="btn">Slide: Potwierdzenie</a>
        <button class="btn" onclick="showSlideOver('/_test/center/notice', {center:true});">Center modal: Powiadomienie</button>
        <button class="btn" onclick="showSlideOver('/_test/center/form', {center:true});">Center modal: Formularz</button>
        <button class="btn" data-slide-html="<div class='p-10'><h3>Inline HTML</h3><p>To jest zawartość wstawiona przez atrybut <code>data-slide-html</code>.</p><button class='btn' onclick=\"showSlideOver('<div class=\\'p-10\\'>Zagnieżdżone HTML</div>', {isHtml:true})\">Zagnieżdżone</button></div>">Inline HTML (data-slide-html)</button>
        <a href="/_test/slide/large" data-slide class="btn">Slide: Duża treść</a>
        <button class="btn" onclick="showToast('To jest toast testowy', 'success')">Pokaż toast</button>
        <button class="btn" onclick="showDrawer('<div class=\'p-10\'><h3>Drawer (right)</h3><p>Przykładowa treść.</p></div>')">Drawer (prawo)</button>
        <button class="btn" onclick="showDrawer('<div class=\'p-10\'><h3>Drawer (left)</h3></div>', {side:'left'})">Drawer (lewo)</button>
        <button class="btn" onclick="showBottomSheet('<div class=\'p-10\'><h3>Bottom sheet</h3><p>{{ _('opcje_akcje') }}</p></div>')">Bottom sheet</button>
        <button class="btn" id="popoverBtn">Popover (przykład)</button>
        <button class="btn" id="fsBtn">Fullscreen modal</button>
        <button class="btn" id="wizBtn">{{ _('wizard_3_kroki') }}</button>
        <button class="btn" id="quickPopupBtn">Quick popup (always works)</button>
    </div>

    <hr>
    <p>Uwaga: slide-over wykorzystuje mechanizm globalnej delegacji kliknięć. Atrybuty: <code>data-slide</code>, <code>data-slide-html</code>, lub wywołanie <code>showSlideOver(url, {center:true})</code>.</p>
</div>

<div class="section-box p-10">
    <div id="diagStatus">Diagnoza: brak</div>
</div>

</script>
<script>
// Use global showQuickPopup (defined in static/scripts.js)
(function(){
    var qbtn = document.getElementById('quickPopupBtn');
    if(qbtn) qbtn.addEventListener('click', function(e){ e.preventDefault(); if(window.showQuickPopup) window.showQuickPopup('Szybkie okno', '<p>To okno działa globalnie przez <code>showQuickPopup</code>.</p><p>Możesz tutaj umieścić formularz lub treść testową.</p>'); else alert('showQuickPopup nie jest zdefiniowane'); });
})();
</script>
</div>
{% endblock %}

<script>
// Diagnostic + safe wrappers for popup helpers
(function(){
    function safeCall(fnName, args){
        try{
            var fn = window[fnName];
            if(typeof fn !== 'function'){
                console.warn(fnName + ' is not defined');
                alert(fnName + ' nie jest zdefiniowane (sprawdź konsolę)');
                return false;
            }
            return fn.apply(window, args || []);
        }catch(e){ console.error(fnName + ' call failed', e); alert(fnName + ' błąd: ' + e.message); }
    }

    function attachHandlers(){
        var p = document.getElementById('popoverBtn');
        if(p) p.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); safeCall('showPopover', [p, '<div style="min-width:180px;"><strong>{{ _('akcje') }}</strong><p><a href="#">{{ _('edycja') }}</a><br><a href="#">{{ _('usun') }}</a></p></div>']); });
        var fs = document.getElementById('fsBtn');
        if(fs) fs.addEventListener('click', function(e){ e.preventDefault(); safeCall('showFullscreenModal', ['<div class="p-10"><h2>Fullscreen Modal</h2><p>Pełnoekranowe okno.</p></div>']); });
        var w = document.getElementById('wizBtn');
        if(w) w.addEventListener('click', function(e){ e.preventDefault(); safeCall('showWizard', [['<h3>{{ _('krok_1') }}</h3><p>{{ _('dane_wejsciowe') }}</p>','<h3>{{ _('krok_2') }}</h3><p>{{ _('sprawdz') }}</p>','<h3>{{ _('krok_3') }}</h3><p>{{ _('podsumowanie') }}</p>']]); });

        // diagnostic status
        var diag = document.getElementById('diagStatus');
        if(diag){
            diag.innerHTML = '<strong>Diagnostics</strong>: showPopover=' + (typeof window.showPopover === 'function') + ', showFullscreenModal=' + (typeof window.showFullscreenModal === 'function') + ', showWizard=' + (typeof window.showWizard === 'function');
        }
    }

    if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', attachHandlers); else attachHandlers();
})();
</script>
