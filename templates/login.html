<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logowanie - AgroNetzwerk</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Favicon / touch icons: prefer SVG, fallback to PNG -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
    <link rel="shortcut icon" href="{{ url_for('static', filename='agro_logo.png') }}" type="image/png">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='agro_logo.png') }}">
</head>
<body class="login-page">

<!-- Language selector -->
<div style="position: absolute; top: 10px; right: 10px; z-index: 100;">
    <select id="language-selector" onchange="changeLanguage(this.value)" style="padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc; cursor: pointer;">
        <option value="pl">Polski</option>
        <option value="uk">Українська</option>
        <option value="en">English</option>
    </select>
</div>

<div class="login-page-body">
<div class="login-card">
    <!-- Use local static logo to avoid external requests and improve availability -->
    <img src="{{ url_for('static', filename='agro_logo.png') }}" alt="AgroNetzwerk" class="login-logo">

    <h2 class="header-title m-0">{{ _('zaloguj_sie') }}</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST">
        <div class="form-group">
            <label for="login" class="form-label">{{ _('login') }}</label>
            <input type="text" id="login" name="login" class="form-input" placeholder="{{ _('wpisz_login') }}" required aria-label="Login">
        </div>
        <div class="form-group">
            <label for="haslo" class="form-label">{{ _('haslo') }}</label>
            <input type="password" id="haslo" name="haslo" class="form-input" placeholder="{{ _('wpisz_haslo') }}" required aria-label="Hasło">
        </div>
        <button type="submit" class="btn-login">{{ _('wejdz') }}</button>
    </form>

    </div>
    </div>

<script>
function changeLanguage(lang) {
    // Ustaw cookie na 365 dni
    const d = new Date();
    d.setTime(d.getTime() + (365*24*60*60*1000));
    const expires = "expires="+ d.toUTCString();
    document.cookie = "app_language=" + lang + ";" + expires + ";path=/";
    
    // Refresh strony z ?lang= parametrem
    window.location.href = window.location.pathname + "?lang=" + lang;
}

// Ustawiamy selektor na domyślny się wybrany język z cookie
window.addEventListener('DOMContentLoaded', function() {
    const langSelector = document.getElementById('language-selector');
    if (langSelector) {
        // Czytaj język z URL lub cookie
        const urlParams = new URLSearchParams(window.location.search);
        const langParam = urlParams.get('lang');
        const langCookie = document.cookie.split('; ').find(row => row.startsWith('app_language='));
        const currentLang = langParam || (langCookie ? langCookie.split('=')[1] : 'pl');
        
        langSelector.value = currentLang;
    }
});
</script>
</body>
</html>