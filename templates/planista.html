{% extends "layout.html" %}

{% block content %}
<style>
    .plan-card {
        background: white; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: 0.2s;
    }
    .status-nieoplacone { border-left: 5px solid #f39c12; background-color: #fcf3cf; }
    .status-zaplanowane { border-left: 5px solid #95a5a6; }
    .status-wtoku { border-left: 5px solid #3498db; background-color: #e3f2fd; }
    .status-zakonczone { border-left: 5px solid #27ae60; background-color: #e8f5e9; opacity: 0.8; }
    
    .palety-list {
        margin-top: 10px; background: #fff; border: 1px solid #eee; padding: 10px; border-radius: 4px; font-size: 0.9em;
    }
    .action-row {
        display: flex; gap: 10px; margin-top: 10px; align-items: center; flex-wrap: wrap;
    }
    .input-date-small { padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
</style>

<div class="section-header">
    <h2 class="header-title">üìÖ Panel Planisty: {{ wybrana_data }}</h2>
    <div class="header-actions">
        <a href="/planista?data={{ prev_date }}" class="btn-add-plan" style="background:#7f8c8d;">‚óÄ Poprzedni</a>
        <input type="date" value="{{ wybrana_data }}" onchange="window.location.href='/planista?data='+this.value" style="padding:8px; border:1px solid #ccc; border-radius:5px;">
        <a href="/planista?data={{ next_date }}" class="btn-add-plan" style="background:#7f8c8d;">Nastƒôpny ‚ñ∂</a>
    </div>
</div>

<div class="add-box" style="border-left: 5px solid #2ecc71;">
    <h4 style="margin-top:0;">+ Nowe Zlecenie</h4>
    <form action="{{ url_for('api.dodaj_plan_zaawansowany') }}" method="POST" class="form-flex">
        <input type="hidden" name="data_planu" value="{{ wybrana_data }}">
        
        <select name="sekcja" style="padding:8px; border-radius:4px; border:1px solid #ccc;">
            <option value="Zasyp">Zasyp</option>
            <option value="Workowanie">Workowanie</option>
            <option value="Magazyn">Magazyn</option>
        </select>

        <input type="text" name="produkt" placeholder="Nazwa produktu" required class="select-flex" style="flex:2;">
        <input type="number" step="0.1" name="tonaz" placeholder="Tony" required style="width:80px; padding:8px;">
        
        <div style="display:flex; align-items:center; gap:5px; background:#fff3cd; padding:5px 10px; border-radius:4px; border:1px solid #ffeeba;">
            <input type="checkbox" id="checkOplata" name="wymaga_oplaty">
            <label for="checkOplata" style="font-size:0.9em; cursor:pointer; color:#856404;">Status: Nieop≈Çacone</label>
        </div>

        <button type="submit" class="btn-add-plan">DODAJ</button>
    </form>
</div>

<hr class="custom-hr">

{% for z in zlecenia %}
    {% set status_class = 'status-' + z[4].replace(' ', '').replace('√≥', 'o') %}
    {% if z[4] == 'w toku' %}{% set status_class = 'status-wtoku' %}{% endif %}
    
    <div class="plan-card {{ status_class }}">
        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
            <div>
                <span style="font-size:0.8em; text-transform:uppercase; color:gray; font-weight:bold;">{{ z[1] }}</span>
                <h3 style="margin: 5px 0;">{{ z[2] }}</h3>
                <div>
                    Plan: <strong>{{ z[3] }} t</strong> 
                    {% if z[5] %} | Wykonanie: <strong style="color:green;">{{ z[5] }} t</strong>{% endif %}
                    {% if z[4] == 'w toku' %}<span style="color:#2980b9; font-weight:bold;"> (W TOKU)</span>{% endif %}
                </div>
            </div>

            <div style="text-align:right;">
                <span style="display:inline-block; padding:4px 8px; border-radius:4px; font-size:0.8em; font-weight:bold; color:white; background: 
                    {% if z[4]=='nieoplacone' %}#f39c12{% elif z[4]=='zaplanowane' %}#95a5a6{% elif z[4]=='w toku' %}#3498db{% else %}#27ae60{% endif %}">
                    {{ z[4].upper() }}
                </span>

                {% if z[4] == 'nieoplacone' %}
                <form action="{{ url_for('api.zmien_status_zlecenia', id=z[0]) }}" method="POST" style="margin-top:5px;">
                    <input type="hidden" name="data_powrotu" value="{{ wybrana_data }}">
                    <input type="hidden" name="status" value="zaplanowane">
                    <button type="submit" style="background:#27ae60; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">üí∞ ZATWIERD≈π OP≈ÅATƒò</button>
                </form>
                {% endif %}
            </div>
        </div>

        {% if palety_mapa[z[0]] %}
        <div class="palety-list">
            <strong>üì¶ Wyprodukowane palety:</strong>
            <ul style="margin:5px 0; padding-left:20px;">
                {% for p in palety_mapa[z[0]] %}
                    <li>Godz: {{ p.czas }} ‚Äî <strong>{{ p.waga|int }} kg</strong></li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="action-row">
            <form action="{{ url_for('api.przenies_zlecenie', id=z[0]) }}" method="POST" style="display:flex; gap:5px; align-items:center;">
                <input type="hidden" name="stara_data" value="{{ wybrana_data }}">
                <label style="font-size:0.85em;">Przenie≈õ na:</label>
                <input type="date" name="nowa_data" required class="input-date-small">
                <button type="submit" style="background:#34495e; color:white; border:none; padding:5px 8px; border-radius:4px; cursor:pointer;">OK</button>
            </form>

            <form action="{{ url_for('api.usun_plan', id=z[0]) }}" method="POST" onsubmit="return confirm('UsunƒÖƒá to zlecenie?');" style="margin-left:auto;">
                <input type="hidden" name="data_powrotu" value="{{ wybrana_data }}">
                <button type="submit" style="color:red; background:none; border:none; cursor:pointer; font-weight:bold;">üóë Usu≈Ñ</button>
            </form>
        </div>
    </div>
{% else %}
    <p style="text-align:center; color:gray; margin-top:30px;">Brak zlece≈Ñ na ten dzie≈Ñ.</p>
{% endfor %}

{% endblock %}