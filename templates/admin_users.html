{% extends "layout.html" %}

{% block content %}

<div class="section-header">
    <h2 class="header-title">‚öôÔ∏è {{ _('zarzadzanie_uzytkownikami') }}</h2>
    <div>
        <a href="/admin" class="btn">{{ _('powrot_do_panelu') }}</a>
    </div>
</div>

<div class="section-box">
    {% if needs_reset and needs_reset|length > 0 %}
    <div class="alert alert-warning">
        <strong>{{ _('uwaga') }}</strong> nastƒôpujƒÖce konta korzystajƒÖ ze starszego formatu hase≈Ç i wymagajƒÖ resetu: {{ needs_reset|join(', ') }}.
        Mo≈ºesz ustawiƒá tymczasowe has≈Ço lub poprosiƒá u≈ºytkownik√≥w o zmianƒô.
    </div>
    {% endif %}

    <div class="p-15 bb-1">
        <h3>Dodaj nowe konto</h3>
        <form action="/admin/konto/dodaj" method="POST" class="form-flex">
            <input name="login" placeholder="{{ _('login') }}" required class="input-sm" aria-label="Login">
            <input name="haslo" placeholder="{{ _('haslo') }}" class="input-sm" aria-label="Has≈Ço">
            <input name="imie_nazwisko" placeholder="{{ _('imie_nazwisko_opt') }}" class="input-sm" aria-label="Imiƒô i nazwisko">
            <select name="rola" class="input-sm" aria-label="Rola">
                {% for r in roles %}
                    <option value="{{ r[0] }}">{{ r[1] }}</option>
                {% endfor %}
            </select>
            <button class="btn btn-primary" type="submit">Dodaj konto</button>
        </form>
    </div>

    <table class="modern-table">
        <thead>
            <tr>
                <th>{{ _('login') }}</th>
                <th>{{ _('rola') }}</th>
                <th class="text-right">{{ _('akcje') }}</th>
            </tr>
        </thead>
        <tbody>
        {% for k in konta %}
            <tr>
                <td>{{ k[1] }}</td>
                <td>{{ k[2] }}</td>
                <td class="text-right">
                    <div class="d-flex justify-end gap-8 align-center">
                        <details class="inline-block">
                            <summary class="btn">{{ _('edytuj') }}</summary>
                            <form action="/admin/konto/edytuj" method="POST" class="form-flex p-10">
                                <input type="hidden" name="id" value="{{ k[0] }}">
                                <input name="login" value="{{ k[1] }}" required class="input-sm" aria-label="Login do edycji">
                                <input name="haslo" placeholder="{{ _('nowe_haslo') }}" class="input-sm" aria-label="Nowe has≈Ço (opcjonalnie)">
                                <select name="rola" class="input-sm" aria-label="Rola do edycji">
                                    {% for r in roles %}
                                        <option value="{{ r[0] }}" {% if k[2]==r[0] %}selected{% endif %}>{{ r[1] }}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" class="btn">{{ _('zapisz') }}</button>
                            </form>
                        </details>

                        <form action="/admin/konto/edytuj" method="POST" class="form-inline">
                            <input type="hidden" name="id" value="{{ k[0] }}">
                            <input type="hidden" name="login" value="{{ k[1] }}">
                            <input type="hidden" name="rola" value="{{ k[2] }}">
                            <input name="haslo" placeholder="Tymczasowe has≈Ço" class="input-sm" aria-label="Tymczasowe has≈Ço">
                            <button type="submit" class="btn btn-warning">{{ _('ustaw_tymczasowe') }}</button>
                        </form>

                        <form action="/admin/konto/usun/{{ k[0] }}" method="POST" onsubmit="return confirm('Usu≈Ñ konto {{ k[1] }}?');">
                            <button type="submit" class="delete-button" aria-label="Usu≈Ñ konto">üóëÔ∏è</button>
                        </form>
                    </div>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="3" class="text-center">{{ _('brak_kont_bazy') }}</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
