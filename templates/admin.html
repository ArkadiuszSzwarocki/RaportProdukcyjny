{% extends "layout.html" %}

{% block content %}

<div class="section-header">
    <h2 class="header-title">⚙️ Panel Administratora</h2>
    <div style="display:flex; gap:10px;">
        <a href="/admin?tab=users" class="btn">Użytkownicy</a>
        <a href="/admin?tab=production" class="btn btn-primary">Produkcja</a>
        <a href="/admin?tab=logs" class="btn">Logi Systemowe</a>
    </div>
</div>

<div class="section-box">
    <div style="padding:15px; border-bottom:1px solid var(--border-color); display:flex; justify-content:space-between; align-items:center;">
        <h3>Zarządzanie Produkcją (Wszystkie Sekcje)</h3>
        <input type="text" placeholder="Szukaj zlecenia..." style="padding:8px; border:1px solid #ddd; border-radius:4px; font-size:0.9em;">
    </div>

    <table class="modern-table">
        <thead>
            <tr>
                <th>Data</th>
                <th>Sekcja</th>
                <th>Produkt</th>
                <th>Tonaż (Plan/Wyk)</th>
                <th>Status</th>
                <th>Lider</th>
                <th class="text-right">Opcje</th>
            </tr>
        </thead>
        <tbody>
        {% for z in zlecenia %}
            <tr>
                <td>{{ z.data_planu }}</td>
                <td>
                    <span class="badge-sekcja">{{ z.sekcja }}</span>
                </td>
                <td><strong>{{ z.produkt }}</strong></td>
                <td>
                    {{ z.tonaz }} t 
                    {% if z.tonaz_rzeczywisty %}
                    <span style="color:var(--success-color);">/ {{ z.tonaz_rzeczywisty }} t</span>
                    {% endif %}
                </td>
                <td>
                    <span class="status-badge status-{{ z.status|replace(' ', '') }}">
                        {{ z.status|upper }}
                    </span>
                </td>
                <td>
                    <span style="font-size:0.9em; color:#888;">System</span>
                </td>
                <td class="text-right">
                    <div style="display:flex; justify-content:flex-end; gap:5px;">
                        <a href="/admin/edycja_zlecenia/{{ z.id }}" class="btn-icon" title="Edytuj">
                            <span class="material-icons">edit</span>
                        </a>
                        <form action="{{ url_for('api.usun_plan', id=z.id) }}" method="POST" onsubmit="return confirm('Czy na pewno usunąć to zlecenie? Operacja jest nieodwracalna.');">
                            <input type="hidden" name="data_powrotu" value="{{ z.data_planu }}">
                            <button type="submit" class="btn-icon btn-delete" title="Usuń">
                                <span class="material-icons">delete</span>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="7" class="text-center">Brak zleceń w bazie.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<style>
    /* Wspólne style tabeli (możesz przenieść do style.css) */
    .modern-table { width:100%; border-collapse:collapse; }
    .modern-table th { background:#f8f9fa; color:var(--text-muted); font-size:0.85em; padding:12px; border-bottom:2px solid var(--border-color); text-align:left; }
    .modern-table td { padding:12px; border-bottom:1px solid var(--border-color); }
    
    .status-badge { padding:3px 8px; border-radius:4px; font-size:0.75em; font-weight:bold; }
    .status-wtoku { background:#e3f2fd; color:#0d47a1; }
    .status-zakonczone { background:#d4edda; color:#155724; }
    
    .badge-sekcja { background:#eee; color:#555; padding:2px 6px; border-radius:3px; font-size:0.85em; border:1px solid #ddd; }

    .btn-icon { background:none; border:none; cursor:pointer; color:var(--text-muted); padding:4px; display:inline-flex; align-items:center; }
    .btn-icon:hover { color:var(--primary-color); background:#f0f0f0; border-radius:4px; }
    .btn-delete:hover { color:var(--danger-color); background:#fff5f5; }
    .text-center { text-align:center; padding:20px; color:#999; }
    .text-right { text-align:right; }
</style>

{% endblock %}