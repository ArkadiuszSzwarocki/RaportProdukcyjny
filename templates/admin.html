{% extends "layout.html" %}

{% block content %}

<div class="section-header">
    <h2 class="header-title">⚙️ Panel Administratora</h2>
    <div class="d-flex gap-10">
        <a href="/admin?tab=users" class="btn">Użytkownicy</a>
        <a href="/admin?tab=production" class="btn btn-primary">Produkcja</a>
        <a href="/admin?tab=logs" class="btn">Logi Systemowe</a>
    </div>
</div>

{% set active_tab = request.args.get('tab', 'production') %}

{% if active_tab == 'users' %}
<div class="section-box">
    <div class="d-flex justify-between align-center p-15" style="border-bottom:1px solid var(--border-color);">
        <h3>Zarządzanie użytkownikami</h3>
        <div class="d-flex gap-8">
            <form action="/admin/konto/dodaj" method="POST" class="form-flex align-center">
                <input name="login" placeholder="Login" required class="input-sm" aria-label="Login użytkownika">
                <input name="haslo" placeholder="Hasło" required class="input-sm" aria-label="Hasło użytkownika">
                <select name="rola" class="input-sm" aria-label="Rola użytkownika">
                    <option value="admin">admin</option>
                    <option value="lider">lider</option>
                    <option value="planista">planista</option>
                    <option value="pracownik">pracownik</option>
                </select>
                <button class="btn btn-primary" type="submit">Dodaj</button>
            </form>
        </div>
    </div>

    <table class="modern-table">
        <thead>
            <tr>
                <th>Login</th>
                <th>Rola</th>
                <th class="text-right">Opcje</th>
            </tr>
        </thead>
        <tbody>
        {% for k in konta %}
            <tr>
                <td>{{ k[1] }}</td>
                <td>{{ k[2] }}</td>
                <td class="text-right">
                    <div class="d-flex justify-end gap-8 align-center">
                        <details style="display:inline-block;">
                            <summary class="btn">Edytuj</summary>
                            <form action="/admin/konto/edytuj" method="POST" class="form-flex p-10">
                                <input type="hidden" name="id" value="{{ k[0] }}">
                                <input name="login" value="{{ k[1] }}" required class="input-sm" aria-label="Login do edycji">
                                <input name="haslo" placeholder="Nowe hasło (opcjonalnie)" class="input-sm" aria-label="Nowe hasło (opcjonalnie)">
                                <select name="rola" class="input-sm" aria-label="Rola do edycji">
                                    <option value="admin" {% if k[2]=='admin' %}selected{% endif %}>admin</option>
                                    <option value="lider" {% if k[2]=='lider' %}selected{% endif %}>lider</option>
                                    <option value="planista" {% if k[2]=='planista' %}selected{% endif %}>planista</option>
                                    <option value="pracownik" {% if k[2]=='pracownik' %}selected{% endif %}>pracownik</option>
                                </select>
                                <button type="submit" class="btn">Zapisz</button>
                            </form>
                        </details>

                        <form action="/admin/konto/usun/{{ k[0] }}" method="POST" onsubmit="return confirm('Usuń konto {{ k[1] }}?');">
                            <button type="submit" class="btn btn-danger">Usuń</button>
                        </form>
                    </div>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="3" class="text-center">Brak kont w bazie.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>


{% else %}

    <div class="section-box">
    <div class="d-flex justify-between align-center p-15" style="border-bottom:1px solid var(--border-color);">
    <h3>Zarządzanie Produkcją (Wszystkie Sekcje)</h3>
    <input type="text" placeholder="Szukaj zlecenia..." class="input-sm small" aria-label="Szukaj zlecenia">
    </div>

    <table class="modern-table">
        <thead>
            <tr>
                <th>Data</th>
                <th>Sekcja</th>
                <th>Produkt</th>
                <th>Tonaż (Plan/Wyk)</th>
                <th>Status</th>
                <th>Lider</th>
                <th class="text-right">Opcje</th>
            </tr>
        </thead>
        <tbody>
        {% for z in zlecenia %}
            <tr>
                <td>{{ z.data_planu }}</td>
                <td>
                    <span class="badge-sekcja">{{ z.sekcja }}</span>
                </td>
                <td><strong>{{ z.produkt }}</strong></td>
                <td>
                    {{ z.tonaz }} t 
                    {% if z.tonaz_rzeczywisty %}
                    <span class="text-success">/ {{ z.tonaz_rzeczywisty }} t</span>
                    {% endif %}
                </td>
                <td>
                    <span class="status-badge status-{{ z.status|replace(' ', '') }}">
                        {{ z.status|upper }}
                    </span>
                </td>
                <td>
                    <span class="small text-muted">System</span>
                </td>
                <td class="text-right">
                    <div class="d-flex justify-end gap-5">
                        <a href="/admin/edycja_zlecenia/{{ z.id }}" class="btn-icon" title="Edytuj">
                            <span class="material-icons">edit</span>
                        </a>
                        <form action="{{ url_for('api.usun_plan', id=z.id) }}" method="POST" onsubmit="return confirm('Czy na pewno usunąć to zlecenie? Operacja jest nieodwracalna.');">
                            <input type="hidden" name="data_powrotu" value="{{ z.data_planu }}">
                            <button type="submit" class="btn-icon btn-delete" title="Usuń">
                                <span class="material-icons">delete</span>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="7" class="text-center">Brak zleceń w bazie.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>

 

{% endif %}

{% endblock %}